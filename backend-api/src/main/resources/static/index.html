<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Duet — Music student & tutor finder</title>
  <meta name="description" content="Find music students and tutors — Duet">
  <link rel="stylesheet" href="/styles.css">
</head>

<body>
  <script>
    window._openModal = function (id) {
      if (window._modals && window._modals[id] && window._modals[id].open) window._modals[id].open();
    };
  </script>
  <div id="bg-wrap" aria-hidden="true">
    <iframe id="bg-iframe"
      src="https://www.youtube.com/embed/IZx6_bCvVNo?autoplay=1&controls=0&loop=1&playlist=IZx6_bCvVNo&mute=1&rel=0&modestbranding=1&playsinline=1"
      frameborder="0" allow="autoplay; fullscreen" allowfullscreen></iframe>
  </div>
  <script>
    (function () {
      const f = document.getElementById('bg-iframe');
      if (!f) return;
      f.style.opacity = '0';
      f.addEventListener('load', () => { setTimeout(() => { f.style.opacity = '1'; }, 120); });
      setTimeout(() => { if (getComputedStyle(f).opacity === '0') f.style.opacity = '1'; }, 2000);
    })();
  </script>
  <header class="top-nav simple" role="banner">
    <div class="nav-container">
      <div class="brand">DUET</div>
      <nav class="simple-nav" aria-label="Top navigation">
        <a href="#about" id="about-link" class="btn-link">About</a>
        <button id="login-btn" class="btn-outline" type="button"
          onclick="(window._modals && window._modals['login-modal'] && window._modals['login-modal'].open && window._modals['login-modal'].open())">Log
          in</button>
        <button id="signup-btn" class="btn-primary" type="button"
          onclick="(window._modals && window._modals['signup-modal'] && window._modals['signup-modal'].open && window._modals['signup-modal'].open())">Sign
          up</button>
      </nav>
    </div>
  </header>

  <main>
    <section class="hero" role="region" aria-labelledby="hero-title">
      <div class="hero-inner">
        <article class="hero-card" aria-label="Duet introduction">
          <div class="card-decor" aria-hidden="true"></div>
          <h1 id="hero-title" class="hero-title">DUET</h1>
          <p class="hero-sub">A music student & tutor finder: connect, practice, and perform together.</p>
          <div class="hero-ctas">
            <button id="hero-signup" class="btn-primary large"
              onclick="(window._modals && window._modals['signup-modal'] && window._modals['signup-modal'].open && window._modals['signup-modal'].open())">Get
              started</button>
            <button id="hero-login" class="btn-outline large"
              onclick="(window._modals && window._modals['login-modal'] && window._modals['login-modal'].open && window._modals['login-modal'].open())">I
              already have an account</button>
          </div>
        </article>
      </div>
    </section>
  </main>

  <script src="/js/common.js"></script>
  <div id="about-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="about-title" aria-hidden="true">
    <div class="modal-backdrop" data-dismiss="backdrop"></div>
    <div class="modal-card" role="document">
      <button class="modal-close" aria-label="Close about dialog">✕</button>
      <h2 id="about-title">About Duet</h2>
      <div class="modal-body">
        <p>Duet helps music students and tutors find each other for lessons, practice sessions, and performances. Create
          profiles, list skills and availability, and connect securely.</p>
        <p>Built with a clean, accessible UI and a focus on musical collaboration.</p>
      </div>
    </div>

  </div>

  <div id="login-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="login-title" aria-hidden="true">
    <div class="modal-backdrop" data-dismiss="backdrop"></div>
    <div class="modal-card" role="document">
      <button class="modal-close" aria-label="Close login dialog">✕</button>
      <h2 id="login-title">Log in</h2>
      <div class="modal-body">
        <form id="login-form">
          <label>Email<br><input type="email" name="email" required></label>
          <label>Password<br><input type="password" name="password" required></label>
          <div style="margin-top:12px;display:flex;gap:8px;align-items:center">
            <button type="submit" class="btn-primary">Sign in</button>
            <button type="button" class="btn-link" id="forgot">Forgot?</button>
          </div>
        </form>

      </div>
    </div>
  </div>

  <div id="signup-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="signup-title"
    aria-hidden="true">
    <div class="modal-backdrop" data-dismiss="backdrop"></div>
    <div class="modal-card" role="document">
      <button class="modal-close" aria-label="Close signup dialog">✕</button>
      <h2 id="signup-title">Sign up</h2>
      <div class="modal-body">
        <form id="signup-form">
          <label>Full name<br><input type="text" name="name" id="signup-name" required></label>
          <label>Email<br><input type="email" name="email" id="signup-email" required></label>
          <label>Password<br><input type="password" name="password" id="signup-password" required></label>
          <label>Account type<br>
            <select id="signup-role" name="role">
              <option value="STUDENT">Student</option>
              <option value="TUTOR">Tutor</option>
            </select>
          </label>
          <div style="margin-top:12px;display:flex;gap:8px;align-items:center">
            <button type="submit" class="btn-primary">Create account</button>
          </div>
        </form>

      </div>
    </div>
  </div>

  <div id="forgot-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="forgot-title"
    aria-hidden="true">
    <div class="modal-backdrop" data-dismiss="backdrop"></div>
    <div class="modal-card" role="document">
      <button class="modal-close" aria-label="Close forgot dialog">✕</button>
      <h2 id="forgot-title">Reset password</h2>
      <div class="modal-body">
        <form id="forgot-form">
          <label>Email<br><input type="email" id="forgot-email" required></label>
          <label>New password<br><input type="password" id="forgot-new" required></label>
          <label>Confirm new password<br><input type="password" id="forgot-confirm" required></label>
          <div style="margin-top:12px;display:flex;gap:8px;align-items:center">
            <button type="submit" class="btn-primary">Update password</button>
          </div>
        </form>
      </div>
    </div>
  </div>
  </div>

  <script>
    (function () {
      function initModals() {
        window._modals = window._modals || {};
        function makeModal(id) {
          const modal = document.getElementById(id);
          if (!modal) return null;
          const closeBtn = modal.querySelector('.modal-close');
          const backdrop = modal.querySelector('[data-dismiss]');
          let lastFocused = null;
          function onKey(e) {
            if (e.key === 'Escape') close();
            if (e.key === 'Tab') {
              const focusable = modal.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
              if (focusable.length === 0) return;
              const first = focusable[0];
              const last = focusable[focusable.length - 1];
              if (e.shiftKey && document.activeElement === first) { e.preventDefault(); last.focus(); }
              else if (!e.shiftKey && document.activeElement === last) { e.preventDefault(); first.focus(); }
            }
          }
          function open() {
            lastFocused = document.activeElement;
            modal.setAttribute('aria-hidden', 'false');
            modal.classList.add('open');
            if (closeBtn) closeBtn.focus();
            document.addEventListener('keydown', onKey);
          }
          function close() {
            modal.setAttribute('aria-hidden', 'true');
            modal.classList.remove('open');
            document.removeEventListener('keydown', onKey);
            if (lastFocused && lastFocused.focus) lastFocused.focus();
          }
          if (closeBtn) closeBtn.addEventListener('click', close);
          if (backdrop) backdrop.addEventListener('click', close);
          const api = { open, close, modal };
          window._modals[id] = api;
          return api;
        }

        const about = makeModal('about-modal');
        const aboutLink = document.getElementById('about-link');
        if (about && aboutLink) aboutLink.addEventListener('click', function (e) { e.preventDefault(); about.open(); });

        const login = makeModal('login-modal');
        const signup = makeModal('signup-modal');
        const forgotModal = makeModal('forgot-modal');
        const loginBtn = document.getElementById('login-btn');
        const signupBtn = document.getElementById('signup-btn');
        const heroLogin = document.getElementById('hero-login');
        const heroSignup = document.getElementById('hero-signup');
        if (loginBtn) { loginBtn.addEventListener('click', () => { if (login) login.open(); else alert('Login modal not found'); }); }
        if (signupBtn) { signupBtn.addEventListener('click', () => { if (signup) signup.open(); else alert('Signup modal not found'); }); }
        if (heroLogin) { heroLogin.addEventListener('click', () => { if (login) login.open(); }); }
        if (heroSignup) { heroSignup.addEventListener('click', () => { if (signup) signup.open(); }); }

        document.querySelectorAll('.oauth').forEach(btn => { btn.addEventListener('click', () => { const provider = btn.dataset.provider || 'oauth'; alert('OAuth sign-in with: ' + provider + '\n(This is a placeholder — wire your auth flow.)'); }); });

        const forgotBtn = document.getElementById('forgot');
        if (forgotBtn) forgotBtn.addEventListener('click', () => { if (login) login.close(); if (forgotModal) forgotModal.open(); });

        const loginForm = document.getElementById('login-form');
        if (loginForm) {
          loginForm.addEventListener('submit', async function (e) {
            e.preventDefault();
            const formData = new FormData(loginForm);
            const email = String(formData.get('email') || '').trim();
            const password = String(formData.get('password') || '').trim();
            try {
              const res = await fetch(`${API_BASE}/login`, {
                method: 'POST', headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email, password })
              });
              if (res.ok) {
                const user = await res.json();
                try { localStorage.setItem('userId', user.id); } catch (_) { }
                if (user.role) { try { localStorage.setItem('userRole', user.role); } catch (_) { } }
                if (user.role === 'TUTOR') window.location.href = '/Tutor/tutor_home.html';
                else if (user.role === 'STUDENT') window.location.href = '/Student/student-home.html';
                else window.location.href = '/Tutor/tutor_home.html';
                if (login) login.close();
              } else {
                let msg = 'Sign in failed';
                try { const err = await res.json(); if (err && (err.error || err.message)) msg = err.error || err.message; } catch (_) { }
                alert(msg);
              }
            } catch (err) {
              console.error(err); alert('Network error during sign in');
            }
          });
        }
        const signupForm = document.getElementById('signup-form');
        if (signupForm) {
          signupForm.addEventListener('submit', async function (e) {
            e.preventDefault();
            const name = document.getElementById('signup-name').value.trim();
            const email = document.getElementById('signup-email').value.trim();
            const password = document.getElementById('signup-password').value.trim();
            const role = document.getElementById('signup-role').value || 'STUDENT';
            try {
              const payload = { name, email, password, role };
              const res = await fetch('/api/users', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
              if (res.ok) {
                const user = await res.json();
                try { localStorage.setItem('userId', user.id); } catch (_) { }
                if (role === 'TUTOR') window.location.href = '/Tutor/tutor_onboard.html';
                else window.location.href = '/Student/student-home.html';
              } else {
                let msg = 'Signup failed';
                try { const err = await res.json(); if (err && (err.error || err.message)) msg = err.error || err.message; } catch (_) { }
                alert(msg);
              }
            } catch (err) {
              console.error(err); alert('Network error during signup');
            }
          });
        }
      }

      if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', initModals);
      else initModals();

    })();
  </script>
  <script>
    (function () {
      const form = document.getElementById('forgot-form');
      if (!form) return;
      form.addEventListener('submit', async function (e) {
        e.preventDefault();
        const email = document.getElementById('forgot-email').value.trim();
        const p1 = document.getElementById('forgot-new').value.trim();
        const p2 = document.getElementById('forgot-confirm').value.trim();
        if (!email || !p1) { alert('Email and new password required'); return; }
        if (p1 !== p2) { alert('Passwords do not match'); return; }
        try {
          const res = await fetch(`${API_BASE}/forgot-password`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ email, newPassword: p1 }) });
          if (res.ok) {
            alert('Password updated. Please sign in.');
            // Close forgot, open login
            if (window._modals && window._modals['forgot-modal']) window._modals['forgot-modal'].close();
            if (window._modals && window._modals['login-modal']) window._modals['login-modal'].open();
          } else {
            let msg = 'Reset failed';
            try { const err = await res.json(); if (err && (err.error || err.message)) msg = err.error || err.message; } catch (_) { }
            alert(msg);
          }
        } catch (err) { alert('Network error during password reset'); }
      });
    })();
  </script>

</body>

</html>